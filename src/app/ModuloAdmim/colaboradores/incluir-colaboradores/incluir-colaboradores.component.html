<div class="d-flex justify-content-between mb-3">
  <h3>
    <a class="d-md-none btn btn-secondary" routerLink="/admin/cargos"><i class="fa fa-arrow-left"></i></a>
    Incluir Colaborador
  </h3>
  <div class="d-flex justify-content-between d-none d-none d-md-flex">
    <a class="btn btn-secondary btn-icon-split me-3" routerLink="/admin/colaboradores">
      <span class="icon">
        <i class="fas fa-arrow-left"></i>
      </span>
      <span class="text px-4">
        Voltar
      </span>
    </a>
    <button class="btn btn-primary btn-icon-split" (click)="submit()" [disabled]="!isEstadoSelect && form.invalid"
      aria-label="Gravar Colaborador">
      <span class="icon">
        <i class="fa fa-check"></i>
      </span>
      <span class="text px-4">
        Gravar
      </span>
    </button>
  </div>
</div>
<hr />
<form class="m-3" [formGroup]="form">

  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="geral-tab" data-bs-toggle="tab" data-bs-target="#geral-tab-pane" type="button"
        role="tab" aria-controls="geral-tab-pane" aria-selected="true">Geral</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="formacoes-tab" data-bs-toggle="tab" data-bs-target="#formacoes-tab-pane"
        type="button" role="tab" aria-controls="formacoes-tab-pane" aria-selected="false">Formações</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="cursos-tab" data-bs-toggle="tab" data-bs-target="#cursos-tab-pane" type="button"
        role="tab" aria-controls="cursos-tab-pane" aria-selected="false">Cursos e Especializações</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="treinamentos-tab" data-bs-toggle="tab" data-bs-target="#treinamentos-tab-pane"
        type="button" role="tab" aria-controls="treinamentos-tab-pane" aria-selected="false">Treinamentos</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="avaliacoes-tab" data-bs-toggle="tab" data-bs-target="#avaliacoes-tab-pane"
        type="button" role="tab" aria-controls="avaliacoes-tab-pane" aria-selected="false">Avaliações</button>
    </li>
  </ul>

  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="geral-tab-pane" role="tabpanel" aria-labelledby="geral-tab" tabindex="0">
      <div class="row">
        <div class="col-12 col-md-10 order-2 order-md-1">
          <h5 class="mt-3">Dados Gerais</h5>
          <div class="row mt-3">
            <div class="col-lg-12">
              <div class="form-floating mb-3">
                <input type="text" class="form-control text-uppercase" id="nome" formControlName="nome" placeholder=""
                  [class.is-invalid]="form.get('nome')?.invalid && form.get('nome')?.touched" />
                <label for="nome" class="label-required">Nome Completo</label>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="form-floating mb-3">
                <input type="date" class="form-control" id="dataNascimento" formControlName="dataNascimento"
                  [class.is-invalid]="form.get('dataNascimento')?.invalid && form.get('dataNascimento')?.touched"
                  placeholder="" />
                <label for="dataNascimento" class="label-required">Data de Nascimento</label>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="cpf" formControlName="cpf"
                  [class.is-invalid]="form.get('cpf')?.invalid && form.get('cpf')?.touched" mask="000.000.000-00"
                  placeholder="" maxlength="14" (blur)="validaCPF()" />
                <label for="cpf" class="label-required">CPF</label>
                <div *ngIf="form.get('cpf')?.errors?.['invalidcpf']" class="invalid-feedback">
                  cpf inválido
                </div>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="identidade" formControlName="identidade"
                  [class.is-invalid]="form.get('identidade')?.invalid && form.get('identidade')?.touched"
                  placeholder="" />
                <label for="identidade">RG</label>
              </div>
            </div>
          </div>
        </div>
        <!--Imagem do perfil do hospital -->
        <div class="col-12 col-md-2 order-1 order-md-2 text-center">
          <div class="card bg-secondary position-relative mx-auto"
            style="width: 200px; aspect-ratio: 1/1; overflow: hidden;">
            <div class="w-100 h-100 d-flex flex-column justify-content-center align-items-center position-relative">

              <!-- Imagem já cortada -->
              <img *ngIf="imagemCortada" [src]="croppedImage" alt="Imagem do hospital" class="img-fluid w-100 h-100"
                style="object-fit: cover;">
              <button *ngIf="imagemCortada" class="btn btn-light btn-sm mt-2 rounded-pill shadow-sm position-absolute"
                style="bottom: 10px; left: 50%; transform: translateX(-50%);" data-bs-toggle="modal"
                data-bs-target="#modalCrop">
                Alterar
              </button>

              <!-- Ícone e botão (se não tiver imagem) -->
              <ng-container *ngIf="!imagemCortada">
                <i class="fa fa-user fa-2x text-light"></i>
                <button class="btn btn-light btn-sm mt-2 rounded-pill shadow-sm" data-bs-toggle="modal"
                  data-bs-target="#modalCrop">
                  Adicionar
                </button>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
      <div class="mt-3">
        <h5>Endereço</h5>
        <div class="row mt-3">
          <div class="col-lg-4">
            <div class="form-floating mb-3">
              <input type="text" class="form-control" id="enderecoCep" placeholder="" formControlName="enderecoCep"
                (blur)="buscarCEP()">
              <label for="enderecoCep">CEP</label>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-6">
            <div class="form-floating mb-3">
              <input type="email" class="form-control" id="enderecoLogradouro" placeholder=""
                formControlName="enderecoLogradouro"
                [class.is-invalid]="form.get('enderecoLogradouro')?.invalid && form.get('enderecoLogradouro')?.touched">
              <label for="enderecoLogradouro" class="label-required">Logradouro</label>
            </div>
          </div>
          <div class="col-lg-2">
            <div class="form-floating mb-3">
              <input type="text" class="form-control" id="enderecoNumero" placeholder=""
                formControlName="enderecoNumero"
                [class.is-invalid]="form.get('enderecoNumero')?.invalid && form.get('enderecoNumero')?.touched">
              <label for="enderecoNumero" class="label-required">Número</label>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="form-floating mb-3">
              <input type="text" class="form-control" id="enderecoComplemento" placeholder=""
                formControlName="enderecoComplemento">
              <label for="enderecoComplemento">Complemento</label>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="form-floating mb-3">
              <input type="text" class="form-control" id="enderecoBairro" placeholder=""
                formControlName="enderecoBairro"
                [class.is-invalid]="form.get('enderecoBairro')?.invalid && form.get('enderecoBairro')?.touched">
              <label for="enderecoBairro" class="label-required">Bairro</label>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="form-floating mb-3">
              <select class="form-select" formControlName="enderecoUF" (input)="buscarMunicipios($event)"
                [class.is-invalid]="form.get('enderecoUF')?.invalid && form.get('enderecoUF')?.touched">
                <option value="" disabled selected></option>
                <option *ngFor="let estado of estados" [value]="estado.sigla">{{estado.nome}}</option>
              </select>
              <label for="enderecoBairro" class="label-required">Estado</label>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="form-floating mb-3">
              <input class="form-control" formControlName="enderecoMunicipio" [disabled]="!isEstadoSelect"
                [class.is-invalid]="form.get('enderecoMunicipio')?.invalid && form.get('enderecoMunicipio')?.touched"
                list="municipioList" />
              <datalist id="municipioList">
                <option *ngFor="let municipio of municipios" [value]="municipio.nome">
              </datalist>
              <label for="enderecoMunicipio" class="label-required">Municipio</label>
            </div>
          </div>
        </div>
      </div>
      <div class="mt-3">
        <h5>Contato</h5>
        <div class="row mt-3">
          <div class="col-lg-6">
            <div class="form-floating mb-3">
              <input type="email" class="form-control" id="email" placeholder="" formControlName="email">
              <label for="email">Email</label>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="form-floating mb-3">
              <input type="tel" class="form-control" id="telefone1" placeholder="" formControlName="telefone1"
                prefix="+55 " [instantPrefix]="true" mask="(00) 0000-0000||(00) 0 0000-0000" />
              <label for="telefone1">Telefone</label>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="form-floating mb-5">
              <input type="text" class="form-control" id="telefone2" placeholder="" formControlName="telefone2"
                prefix="+55 " [instantPrefix]="true" mask="(00) 0000-0000||(00) 0 0000-0000" />
              <label for="telefone2">Telefone</label>
            </div>
          </div>
        </div>
      </div>
      <div class="mt-3">
        <h5>Cargo</h5>
        <div class="row mt-3">
          <div class="col-lg-4">
            <div class="form-floating input-group mb-5">
              <input type="text" class="form-control" placeholder="" formControlName="cargo" (blur)="validaCargo()"
                readonly [class.is-invalid]="form.get('cargo')?.invalid && form.get('cargo')?.touched" />
              <label>Cargo</label>
              <button class="input-group-text px-3 bg-white" data-bs-toggle="modal" data-bs-target="#modalCargos"
                role="button"><i class="fas fa-search"></i></button>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="form-floating mb-5">
              <input type="text" class="form-control" placeholder="" mask="separator.2" thousandSeparator="."
                prefix="R$ " formGroupName="salario" mask="separator.2" thousandSeparator="." prefix="R$ "
                [allowNegativeNumbers]="false" [leadZero]="true" [instantPrefix]="true"
                [class.is-invalid]="form.get('salario')?.invalid && form.get('salario')?.touched">
              <label>Salario</label>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="form-floating mb-5">
              <input type="date" class="form-control" placeholder="" formControlName="dataInicio"
                [class.is-invalid]="form.get('dataInicio')?.invalid && form.get('dataInicio')?.touched" />
              <label>Data de Inicio</label>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="tab-pane fade" id="formacoes-tab-pane" role="tabpanel" aria-labelledby="formacoes-tab" tabindex="0">
      <div class="mt-3">
        <table class="table border rounded table-striped align-middle">
          <thead>
            <tr>
              <th></th>
              <th>Formação</th>
              <th>Ano de Conclusão</th>
              <th>Instituição de Ensino</th>
              <th>
                <button class="btn btn-primary btn-icon-split float-end" (click)="submit()">
                  <span class="icon">
                    <i class="fa fa-plus"></i>
                  </span>
                  <span class="text px-4">
                    Adicionar
                  </span>
                </button>
              </th>
            </tr>
          </thead>
          <tbody class="table-group-divider">
          </tbody>
        </table>
      </div>
    </div>





  </div>
  <!-- Final do forms para celular -->
  <div class="d-md-none d-flex justify-content-center">
    <button class="btn btn-primary btn-icon-split" (click)="submit()" [disabled]="!isEstadoSelect && form.invalid"
      aria-label="Gravar Colaborador">
      <span class="icon">
        <i class="fa fa-check"></i>
      </span>
      <span class="text px-4">
        Gravar
      </span>
    </button>
  </div>
</form>
<div class="modal fade" id="modalCrop" tabindex="-1" aria-labelledby="modalCropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalCropLabel">Selecionar Foto</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">

        <!-- Input de imagem -->
        <input type="file" accept="image/*" (change)="fileChangeEvent($event)" class="form-control mb-3" />

        <!-- Cropper -->
        <image-cropper [imageChangedEvent]="imageChangedEvent" [resizeToWidth]="256" [cropperMinWidth]="100"
          [cropperMinHeight]="100" (imageCropped)="onImageCropped($event)" [style.max-height]="'60vh'">
        </image-cropper>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button class="btn btn-primary" data-bs-dismiss="modal" (click)="applyCrop()">Aplicar</button>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="modalCargos" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-full">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Selecionar Cargos</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex justify-content-end">
          <div class="form-floating">
            <input type="text" class="form-control" placeholder="" />
            <label>Pesquisar</label>
          </div>
        </div>
        <div class="mt-3">
          <table class="table border rounded table-striped align-middle">
            <thead>
              <tr>
                <th></th>
                <th>Cargo</th>
                <th>Descrição de Função</th>
                <th>Escolaridade</th>
                <th>Salario Base</th>
              </tr>
            </thead>
            <tbody class="table-group-divider">
              <tr *ngFor="let cargo of cargos">
                <td>
                  <i class="fa fa-check text-success" role="button" (click)="selecionarCargo(cargo.cargo)"
                    data-bs-dismiss="modal"></i>
                </td>
                <td>{{cargo.cargo}}</td>
                <td>{{ cargo.descricaoDeFuncao }}</td>
                <td>{{cargo.escolaridade}}</td>
                <td style="min-width: 150px;">R$ {{ cargo.salarioBase | mask: 'separator.2': { thousandSeparator: '.',
                  decimalMarker: ',', leadZero: true } }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>